<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/logo.png">
    <title>Mar Adentro</title>
    <link rel="stylesheet" href="./styles/main.css">
    <style>
        /* Estilos para botón de promoción */
        .promo-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(90deg, #ff9800 0%, #ff5722 100%);
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            margin: 10px 0 0 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }
        .promo-btn i {
            font-size: 1.3em;
        }
        .promo-btn:hover, .promo-btn:focus {
            background: linear-gradient(90deg, #ff5722 0%, #ff9800 100%);
            transform: translateY(-2px) scale(1.04);
        }
        
        /* Estilos para modales de promoción */
        .promo-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .promo-modal-content {
            background: #fff;
            padding: 32px 24px;
            border-radius: 12px;
            max-width: 350px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            animation: slideUp 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        
        .promo-modal-close {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }
        
        .promo-modal-close:hover {
            color: #333;
        }
        
        .promo-badge {
            font-weight: 700;
            font-size: 1.2rem;
            color: #e67e22;
            margin-bottom: 8px;
        }
        
        .promo-title {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #333;
        }
        
        .promo-description {
            margin-bottom: 12px;
            color: #555;
            line-height: 1.5;
        }
        
        .promo-list {
            text-align: left;
            margin: 16px 0;
            padding-left: 20px;
        }
        
        .promo-list li {
            margin-bottom: 8px;
            color: #444;
        }
        
        .promo-note {
            font-size: 0.95rem;
            color: #777;
            font-style: italic;
            margin-top: 16px;
        }
        
        /* Estilos para modal de oferta */
        .offer-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .offer-modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 16px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: slideUp 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        
        .offer-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 1.8rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            line-height: 1;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .offer-modal-close:hover {
            background: #f5f5f5;
            color: #333;
        }
        
        .offer-badge {
            background: linear-gradient(90deg, #ff5722, #ff9800);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 16px;
        }
        
        .offer-img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 12px 0;
        }
        
        .offer-title {
            font-size: 1.4rem;
            margin: 12px 0;
            color: #333;
        }
        
        .offer-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .promo-btn {
                font-size: 0.95rem;
                padding: 7px 14px;
            }
            
            .promo-modal-content,
            .offer-modal-content {
                width: 95%;
                padding: 20px 16px;
                margin: 10px;
            }
        }
    </style>
    <link rel="stylesheet" href="./styles/animations.css">
    <link rel="stylesheet" href="./styles/colors.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PWERTNSBP6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PWERTNSBP6');
    </script>
</head>
<body>
    <!-- Navbar importado -->
    <div id="navbar-placeholder"></div>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-background"></div>
        <div class="hero-content">
            <div class="hero-badge">¡Bienvenidos!</div>
            <h1 class="hero-title">MAR ADENTRO</h1>
            <p class="hero-subtitle">Un lugar para compartir y disfrutar diario</p>
            <div class="hero-buttons">
                <a href="#menu" class="btn btn-primary">
                    <span>Ver nuestra carta</span>
                    <i class="fas fa-utensils"></i>
                </a>
                <a href="#contact" class="btn btn-outline">
                    <span>Contáctanos</span>
                    <i class="fas fa-phone"></i>
                </a>
            </div>
        </div>
        <div class="hero-scroll-indicator">
            <span>Desliza</span>
            <div class="scroll-arrow"></div>
        </div>
    </section>

    <section class="about" id="about">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Nuestra Historia</h2>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <p>Desde 2025, en Mar Adentro nos encanta reunir amigos y familias para disfrutar juntos. Aquí cada día se vive con alegría, buena comida y recuerdos que se quedan en el corazón.</p>
                    <div class="about-features">
                        <div class="feature">
                            <i class="fas fa-heart"></i>
                            <span>Pasión</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-users"></i>
                            <span>Familia</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-star"></i>
                            <span>Calidad</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-utensils"></i>
                            <span>Sabor</span>
                        </div>
                    </div>
                </div>
                <div class="about-image">
                    <div class="image-frame">
                        <img src="./images/restaurant-exterior.jpg" alt="Exterior del restaurante" loading="lazy">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Menu Section -->
    <section class="menu" id="menu">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Nuestra Carta</h2>
                <p class="section-subtitle">Deliciosos platos preparados con ingredientes frescos</p>
                <div class="section-divider"></div>
                <button class="promo-btn" id="promo-cumple-btn" style="margin: 16px 0;">
                    <i class="fas fa-birthday-cake"></i>
                    <span>Promoción cumpleañero</span>
                </button>
            </div>
            
            <div class="menu-filters">
                <button class="filter-btn active" data-category="ceviches">
                    <i class="fas fa-fish"></i>
                    <span>Ceviches</span>
                </button>
                <button class="filter-btn" data-category="chicharrones">
                    <i class="fas fa-drumstick-bite"></i>
                    <span>Chicharrones</span>
                </button>
                <button class="filter-btn" data-category="arroces-chaufas">
                    <i class="fas fa-bowl-rice"></i>
                    <span>Arroces y Chaufas</span>
                </button>
                <button class="filter-btn" data-category="sopas-calientes">
                    <i class="fas fa-mug-hot"></i>
                    <span>Platos Calientes</span>
                </button>
                <button class="filter-btn" data-category="pescados-plancha-fritos">
                    <i class="fas fa-fish"></i>
                    <span>Plancha y Fritos</span>
                </button>
                <button class="filter-btn" data-category="pastas">
                    <i class="fas fa-pizza-slice"></i>
                    <span>Pastas</span>
                </button>
                <button class="filter-btn" data-category="combos">
                    <i class="fas fa-layer-group"></i>
                    <span>Combos</span>
                </button>
                <button class="filter-btn" data-category="causas">
                    <i class="fas fa-lemon"></i>
                    <span>Causas</span>
                </button>
                <button class="filter-btn" data-category="bebidas">
                    <i class="fas fa-glass-whiskey"></i>
                    <span>Bebidas</span>
                </button>
                <button class="filter-btn" data-category="economico">
                    <i class="fas fa-glass-whiskey"></i>
                    <span>Económico</span>
                </button>
            </div>
            
            <div class="menu-items" id="menu-items">
                <!-- Los productos se cargarán dinámicamente desde JS -->
            </div>
        </div>
    </section>

    <!-- Sección de Comentarios -->
    <section class="testimonials" id="testimonials">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Testimonios</h2>
                <p class="section-subtitle">Lo que nuestros clientes dicen</p>
                <div class="section-divider"></div>
            </div>
            <div class="testimonial-carousel">
                <div class="testimonial-item active">
                    <div class="testimonial-content">
                        <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                        <p class="testimonial-text">La comida es deliciosa y la atención excelente. Volveré pronto.</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>Ana R.</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                        <p class="testimonial-text">El ambiente es muy acogedor, ideal para compartir en familia.</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>Luis M.</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                        <p class="testimonial-text">Me encantó el ceviche y la rapidez del servicio.</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>Carla S.</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                        <p class="testimonial-text">Excelente variedad de platos y precios accesibles. Recomendado.</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>Pedro T.</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                        <p class="testimonial-text">El local es limpio y el personal muy amable. Volveré con mi familia.</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>Rosa G.</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <div class="testimonial-content">
                        <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                        <p class="testimonial-text">La jarra de chicha gratis fue el mejor detalle. Gracias.</p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>Javier P.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Contáctanos</h2>
                <p class="section-subtitle">Estamos aquí para atenderte</p>
                <div class="section-divider"></div>
            </div>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-text">
                            <h4>Dirección</h4>
                            <p>Av. 12 Noviembre 1309 - Florencia De Mora</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="info-text">
                            <h4>Teléfono</h4>
                            <p><a href="tel:+51920035270">920 035 270</a></p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="info-text">
                            <h4>WhatsApp</h4>
                            <p><a href="https://wa.me/51920035270?text=Hola%2C%20quiero%20más%20información..." target="_blank">Enviar mensaje</a></p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="info-text">
                            <h4>Horario</h4>
                                <p>Lun, Mar, Jue, Vie: 7:00 PM - 12:00 AM</p>
                                <p>Sáb, Dom: 9:00 AM - 3:00 PM</p>
                        </div>
                    </div>
                </div>
                <div class="contact-map">
                    <div class="map-container">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d987.5493821828859!2d-79.01977838179201!3d-8.081327298807768!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x91ad3d105ee65145%3A0x32ec4c1f96661ab!2sLa%20esquina%20del%20combinado!5e0!3m2!1ses-419!2spe!4v1764369414299!5m2!1ses-419!2spe" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer importado -->
    <div id="footer-placeholder"></div>

    <!-- Floating Cart Button -->
    <button type="button" class="cart-float" id="cart-btn">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cart-count">0</span>
    </button>

    <!-- Cart Modal -->
    <div class="cart-overlay" id="cart-overlay"></div>
    <div class="cart-container" id="cart-modal">
        <!-- Paso 1: Vista del Carrito -->
        <div class="cart-step" id="cart-step-1">
            <div class="cart-header">
                <h3>Tu Pedido</h3>
                <button class="close-cart" id="close-cart">&times;</button>
            </div>
            <div class="cart-items" id="cart-items">
                <!-- Los items del carrito se agregarán aquí dinámicamente -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cart-total">S/0.00</span>
                </div>
                <button class="btn btn-primary" id="checkout">Realizar Pedido</button>
            </div>
        </div>

        <!-- Paso 2: Formulario de Información -->
        <div class="cart-step" id="cart-step-2">
            <div class="cart-header">
                <button class="back-to-cart" id="back-to-cart">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h3>Información del Pedido</h3>
                <button class="close-cart" id="close-cart-2">&times;</button>
            </div>
            <!-- Dentro del cart-step-2, modifica el formulario así: -->
            <div class="customer-info">
                <form id="order-form">
                    <div class="form-group">
                        <label for="customer-name">Nombre *</label>
                        <input type="text" id="customer-name" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-phone">Teléfono *</label>
                        <input type="tel" id="customer-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="delivery-payment">Tipo de Pago *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="delivery-payment" value="Efectivo" required> Efectivo</label>
                            <label><input type="radio" name="delivery-payment" value="Yape"> Yape</label>
                            <label><input type="radio" name="delivery-payment" value="Plin"> Plin</label>
                            <label><input type="radio" name="delivery-payment" value="Otro"> Tarjeta</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="delivery-type">Tipo de Entrega *</label>
                        <select id="delivery-type" required>
                            <option value="">Seleccionar</option>
                            <option value="pickup">Recoger en el Local</option>
                            <option value="delivery">Delivery</option>
                        </select>
                    </div>
                    
                    <!-- Campos para Recoger en Local -->
                    <div class="delivery-fields" id="pickup-fields">
                        <div class="form-group">
                            <label for="pickup-time">Tiempo estimado para recoger *</label>
                            <select id="pickup-time" required>
                                <option value="">Seleccionar</option>
                                <option value="20-25">20 - 25 minutos</option>
                                <option value="25-30">25 - 30 minutos</option>
                                <option value="30-plus">30 minutos a más</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pickup-notes">Observaciones</label>
                            <textarea id="pickup-notes" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <!-- Campos para Delivery -->
                    <div class="delivery-fields" id="delivery-fields">
                        <div class="form-group">
                            <label for="delivery-address">Dirección de Entrega *</label>
                            <input type="text" id="delivery-address">
                        </div>
                        <div class="form-group">
                            <label for="delivery-notes">Observaciones</label>
                            <textarea id="delivery-notes" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" id="cancel-order">Cancelar</button>
                <button class="btn btn-primary" id="submit-order">Enviar Pedido</button>
            </div>
        </div>
    </div>

    <!-- Scripts existentes -->
    <script src="./scripts/products.js"></script>
    <script src="./scripts/cart.js"></script>
    <script src="./scripts/main.js"></script>

    <!-- Modal Promoción Cumpleañero -->
    <div id="promo-cumple-modal" class="promo-modal-overlay">
        <div class="promo-modal-content">
            <button class="promo-modal-close" id="close-promo-modal">&times;</button>
            <div class="promo-badge">Promoción Cumpleañero</div>
            <h2 class="promo-title">¡Celebra tu cumpleaños con nosotros!</h2>
            <p class="promo-description">Si vienes el día de tu cumpleaños y consumes solo platos de la carta:</p>
            <ul class="promo-list">
                <li>Por <b>8 personas</b>: <b>una torre chelera gratis</b></li>
                <li>Por <b>2 personas</b>: <b>una cerveza gratis</b></li>
            </ul>
            <p class="promo-note">*Válido solo para el cumpleañero y acompañantes. Aplica solo en platos de la carta.</p>
        </div>
    </div>

    <!-- Modal Oferta Mensual Mejorado -->
    <div id="offer-modal" class="offer-modal-overlay">
        <div class="offer-modal-content">
            <button class="offer-modal-close" id="close-offer-modal">&times;</button>
            <div class="offer-badge">Oferta Especial</div>
            <img src="./images/menu/oferta.jpg" alt="Oferta del mes" class="offer-img" />
            <h2 class="offer-title">¡Oferta del Mes!</h2>
            <p class="offer-description">Por la compra de un <b>dúo</b> o <b>trío</b> te llevas <b>gratis una Pepsi de 330ml</b>.</p>
            <button class="btn btn-primary" id="close-offer-btn">¡Quiero mi Pepsi gratis!</button>
        </div>
    </div>

    <!-- Script para Confetti Mejorado -->
    <script>
        // Confetti Manager mejorado
        class ConfettiManager {
            constructor() {
                this.canvas = null;
                this.ctx = null;
                this.particles = [];
                this.animationId = null;
                this.isActive = false;
                this.colors = ['#ff9800', '#ff5722', '#4caf50', '#2196f3', '#e91e63', '#fff200'];
                this.frameCount = 0;
                
                // Manejar redimensionamiento
                window.addEventListener('resize', () => {
                    if (this.isActive && this.canvas) {
                        this.resizeCanvas();
                    }
                });
            }

            launch() {
                // Limpiar confetti anterior si existe
                this.stop();
                
                // Crear canvas
                this.canvas = document.createElement('canvas');
                this.canvas.id = 'confetti-canvas';
                this.canvas.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    pointer-events: none;
                    z-index: 1001;
                `;
                document.body.appendChild(this.canvas);
                
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                this.createParticles();
                this.isActive = true;
                this.frameCount = 0;
                this.animate();
                
                // Auto-limpiar después de 7 segundos
                setTimeout(() => this.stop(), 7000);
            }

            resizeCanvas() {
                if (!this.canvas) return;
                
                const dpr = window.devicePixelRatio || 1;
                const rect = this.canvas.getBoundingClientRect();
                
                this.canvas.width = rect.width * dpr;
                this.canvas.height = rect.height * dpr;
                
                this.ctx.scale(dpr, dpr);
            }

            createParticles() {
                this.particles = [];
                const particleCount = Math.min(100, Math.floor(window.innerWidth / 10));
                
                for (let i = 0; i < particleCount; i++) {
                    this.particles.push({
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * -window.innerHeight,
                        r: Math.random() * 6 + 3,
                        d: Math.random() * particleCount + 10,
                        color: this.colors[Math.floor(Math.random() * this.colors.length)],
                        tilt: Math.random() * 10 - 5,
                        tiltAngle: 0,
                        tiltAngleIncrement: Math.random() * 0.1 + 0.01,
                        wind: Math.random() * 0.5 - 0.25,
                        gravity: 0.05 + Math.random() * 0.05,
                        opacity: 0.8 + Math.random() * 0.2,
                        shape: Math.random() > 0.3 ? 'circle' : 'rectangle'
                    });
                }
            }

            drawParticle(particle) {
                this.ctx.save();
                this.ctx.translate(particle.x, particle.y);
                this.ctx.rotate(particle.tiltAngle);
                this.ctx.globalAlpha = particle.opacity;
                
                if (particle.shape === 'circle') {
                    // Círculo
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, particle.r, 0, Math.PI * 2);
                    this.ctx.fillStyle = particle.color;
                    this.ctx.fill();
                } else {
                    // Rectángulo (confeti)
                    this.ctx.fillStyle = particle.color;
                    this.ctx.fillRect(-particle.r, -particle.r/3, particle.r*2, particle.r/1.5);
                }
                
                this.ctx.restore();
            }

            updateParticle(particle) {
                // Física mejorada
                particle.tiltAngle += particle.tiltAngleIncrement;
                particle.y += particle.d * particle.gravity;
                particle.x += Math.sin(particle.d * 0.1) * 0.5 + particle.wind;
                
                // Reaparecer arriba si sale por abajo
                if (particle.y > window.innerHeight + particle.r) {
                    particle.y = -particle.r;
                    particle.x = Math.random() * window.innerWidth;
                }
                
                // Desvanecer gradualmente al final
                if (this.frameCount > 140) {
                    const fadeStart = 140;
                    const fadeDuration = 100;
                    const progress = Math.min(1, (this.frameCount - fadeStart) / fadeDuration);
                    particle.opacity = 0.8 * (1 - progress);
                }
            }

            animate() {
                if (!this.isActive || !this.ctx) return;
                
                this.frameCount++;
                
                // Limpiar canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Dibujar y actualizar partículas
                this.particles.forEach(particle => {
                    this.updateParticle(particle);
                    this.drawParticle(particle);
                });
                
                this.animationId = requestAnimationFrame(() => this.animate());
            }

            stop() {
                this.isActive = false;
                this.frameCount = 0;
                
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
                
                if (this.canvas && this.canvas.parentNode) {
                    this.canvas.parentNode.removeChild(this.canvas);
                }
                
                this.particles = [];
                this.canvas = null;
                this.ctx = null;
            }
        }

        // Inicialización cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            const confettiManager = new ConfettiManager();
            
            // Modal de promoción cumpleañero
            const promoBtn = document.getElementById('promo-cumple-btn');
            const promoModal = document.getElementById('promo-cumple-modal');
            const closePromo = document.getElementById('close-promo-modal');
            
            if (promoBtn && promoModal && closePromo) {
                promoBtn.onclick = function() {
                    promoModal.style.display = 'flex';
                    confettiManager.launch();
                };
                
                closePromo.onclick = function() {
                    promoModal.style.display = 'none';
                    confettiManager.stop();
                };
                
                // Cerrar modal al hacer clic fuera
                promoModal.onclick = function(e) {
                    if (e.target === promoModal) {
                        promoModal.style.display = 'none';
                        confettiManager.stop();
                    }
                };
            }
            
            // Modal de oferta mensual
            const offerModal = document.getElementById('offer-modal');
            const closeOfferBtn = document.getElementById('close-offer-modal');
            const closeOfferBtn2 = document.getElementById('close-offer-btn');
            
            if (offerModal && closeOfferBtn && closeOfferBtn2) {
                // Mostrar modal después de 1 segundo
                setTimeout(function() {
                    offerModal.style.display = 'flex';
                }, 1000);
                
                closeOfferBtn.onclick = function() {
                    offerModal.style.display = 'none';
                };
                
                closeOfferBtn2.onclick = function() {
                    offerModal.style.display = 'none';
                    // Ir a la sección carta
                    const carta = document.getElementById('menu');
                    if (carta) {
                        carta.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else {
                        // Si no existe el id, redirige por hash
                        window.location.hash = '#menu';
                    }
                };
                
                // Cerrar modal al hacer clic fuera
                offerModal.onclick = function(e) {
                    if (e.target === offerModal) {
                        offerModal.style.display = 'none';
                    }
                };
            }
            
            // Cerrar modales con tecla Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (promoModal && promoModal.style.display === 'flex') {
                        promoModal.style.display = 'none';
                        confettiManager.stop();
                    }
                    if (offerModal && offerModal.style.display === 'flex') {
                        offerModal.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>